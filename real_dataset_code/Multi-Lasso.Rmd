---
title: "Multi-Lasso"
author: "Yuhao Li"
date: '2023-02-08'
output: html_document
---


## Test Multi-variate Lasso distribution(Normalizing constant)
```{r}
library(here)
source(here("code","lasso_distribution","Multi-Lasso.R")) 

A = matrix(c(2,0,0,3),2,2)
b = matrix(c(-2,-1),2,1)
c = 3
print(zmlasso(A,b,c))

```

```{r}
library(pracma)
fun <- function(x,y)
{
  A = matrix(c(2,0,0,3),2,2)
  b = matrix(c(-2,-1),2,1)
  c = 3
  return(exp((-0.5*(A[1,1]*x^2+(A[1,2]+A[2,1])*x*y+A[2,2]*y^2) + b[1]*x + b[2]*y -  c*abs(x)-c*(abs(y)))))
}
```


```{r}
xmin <- -Inf; xmax <- Inf
ymin <- -Inf; ymax <- Inf

# Normalizing constant
dblquad(fun, xmin, xmax, ymin, ymax)
# integral2(fun, xmin, xmax, ymin, ymax)
```












Test Exp property


```{r}
xmin <- 0; xmax <- Inf
ymin <- 0; ymax <- Inf

actual_fun <- function(x,y)
{
  A = matrix(c(2,0,0,3),2,2)
  b = matrix(c(-2,-1),2,1)
  c = 3
  return(exp((-0.5*(A[1,1]*x^2+(A[1,2]+A[2,1])*x*y+A[2,2]*y^2) + b[1]*x + b[2]*y -  c*abs(x)-c*abs(y))))
}

# Normalizing constant
a = dblquad(actual_fun, xmin, xmax, ymin, ymax)
a
# integral2(fun, xmin, xmax, ymin, ymax)
```




```{r}
fun <- function(x,y)
{
  A = matrix(c(2,0,0,3),2,2)
  b = matrix(c(-2,-1),2,1)
  c = 3
  return(exp((-0.5*(A[1,1]*x^2-(A[1,2]+A[2,1])*x*y+A[2,2]*y^2) + (b[1]-c)*x +(-b[2]-c)*y)))
}


xmin <- 0; xmax <- Inf
ymin <- 0; ymax <- Inf

# Normalizing constant
dblquad(fun, xmin, xmax, ymin, ymax)
# integral2(fun, xmin, xmax, ymin, ymax)
```



```{r}
xmin <- 0; xmax <- Inf
ymin <- -Inf; ymax <- 0

# Normalizing constant
b = dblquad(actual_fun, xmin, xmax, ymin, ymax)
b
# integral2(fun, xmin, xmax, ymin, ymax)
```
SO equality 1 is TRUE



```{r}
xmin <- -Inf; xmax <- 0
ymin <- 0; ymax <- Inf

# Normalizing constant
c = dblquad(actual_fun, xmin, xmax, ymin, ymax)
c
```


```{r}
xmin <- 0; xmax <- Inf
ymin <- 0; ymax <- Inf
fun <- function(x,y)
{
  A = matrix(c(2,0,0,3),2,2)
  b = matrix(c(-2,-1),2,1)
  c = 3
  return(exp((-0.5*(A[1,1]*x^2+(A[1,2]+A[2,1])*x*y+A[2,2]*y^2) +(-b[1]-c)*x +(b[2]-c)*y)))
}
# Normalizing constant
dblquad(fun, xmin, xmax, ymin, ymax)

```
So Equality 2 is True




```{r}
xmin <- -Inf; xmax <- 0
ymin <- -Inf; ymax <- 0

# Normalizing constant
d = dblquad(actual_fun, xmin, xmax, ymin, ymax)
d
# integral2(fun, xmin, xmax, ymin, ymax)
```


```{r}
xmin <- 0; xmax <- Inf
ymin <- 0; ymax <- Inf

fun <- function(x,y)
{
  A = matrix(c(2,0,0,3),2,2)
  b = matrix(c(-2,-1),2,1)
  c = 3
  return(exp((-0.5*(A[1,1]*x^2+(A[1,2]+A[2,1])*x*y+A[2,2]*y^2) -( b[1]+c)*x -(b[2]+c)*y)))
}

# Normalizing constant
dblquad(fun, xmin, xmax, ymin, ymax)
# integral2(fun, xmin, xmax, ymin, ymax)
```
So Equality 3 is True

```{r}
a + b + c + d
```





```{r}
xmin <- 0; xmax <- Inf
ymin <- 0; ymax <- Inf

fun <- function(x,y)
{
  A = matrix(c(2,0,0,3),2,2)
  b = matrix(c(-2,-1),2,1)
  c = 3
  A_inv = solve(A)
  mu1 = A_inv%*%(b-c)
  Amu = A%*%mu1
  k = -0.5*((x-mu1[1])^2 * A[1,1] + A[1,2]*A[2,1]*(x-mu1[1])*(y-mu1[2]) + (y-mu1[2])^2*A[2,2])
  g = 0.5*((A_inv[1,1]*Amu[1]^2)+(A_inv[1,2]+A_inv[2,1])*Amu[1]*Amu[2]+A_inv[2,2]*Amu[2]^2)
  
  # vx = matrix(c(x,y))
  value = exp(k+g)
  # value = exp(-0.5*t(vx-mu1)%*%A%*%(vx-mu1) + 0.5*(t(mu1)%*%solve(A)%*%mu1))
    # value = exp((-0.5*(A[1,1]*x^2+(A[1,2]+A[2,1])*x*y+A[2,2]*y^2) + b[1]*x + b[2]*y -  c*x-c*(y)))
  return(value)
}

# Normalizing constant
dblquad(fun, xmin, xmax, ymin, ymax)
# integral2(fun, xmin, xmax, ymin, ymax)
```

```{r}
  A = matrix(c(2,0,0,3),2,2)
  b = matrix(c(-2,-1),2,1)
  c = 3
  A_inv = solve(A)
  mu1 = A_inv%*%(b-c)
  Amu = A%*%mu1
exp(0.5*((A_inv[1,1]*Amu[1]^2)+(A_inv[1,2]+A_inv[2,1])*Amu[1]*Amu[2]+A_inv[2,2]*Amu[2]^2))*2*pi*sqrt(det(A_inv))*pmvnorm(0,Inf,mean = as.vector(mu1), sigma = A_inv)[1]

```
```{r}
det(A_inv)*pmvnorm(0,Inf,mean = as.vector(mu1), sigma = A_inv)[1]/dmvnorm(as.vector(A%*%mu1),sigma = A)
```



