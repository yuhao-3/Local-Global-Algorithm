"0","source(here(""code"",""lasso_distribution"",""dlasso.R"")) "
"0",""
"0",""
"0",""
"0","trapint <- function(xgrid, fgrid) "
"0","{"
"0","  ng <- length(xgrid)"
"0","  xvec <- xgrid[2:ng] - xgrid[1:(ng - 1)]"
"0","  fvec <- fgrid[1:(ng - 1)] + fgrid[2:ng]"
"0","  integ <- sum(xvec * fvec)/2"
"0","  return(integ)"
"0","}"
"0",""
"0","vb_phc <- function(mu, sigma, N, nsd, a_til, b_til, vmu_til, mSigma_til, XTX, XTy, lambda, j ) "
"0","{"
"0","  x <- seq(mu - nsd*sigma, mu + nsd*sigma, length=N)"
"0","  y <- 0*x"
"0","  "
"0","  lambda2 <- lambda*lambda"
"0","  "
"0","  mQ <- solve(XTX + lambda2*res_mfvb$vd, tol=1.0E-99)"
"0","  vmu <- mQ%*%XTy"
"0","  "
"0","  m  <- XTy[j] - XTX[j,-j]%*%vmu[-j]"
"0","  s2 <- XTX[j,-j]%*%mQ[-j,-j]%*%XTX[-j,j]"
"0","  s  <- sqrt(s2)"
"0","  "
"0","  m  <- as.vector(m)"
"0","  s2 <- as.vector(s2)"
"0","  s  <- as.vector(s)"
"0","  "
"0","  K <- 5000"
"0","  mBeta <- t(rmvnorm(K, vmu_til, sigma=mSigma_til))"
"0","  vB <- (XTy[j] - XTX[j,-j]%*%mBeta[-j,])"
"0","  "
"0","  for (i in 1:K) {"
"0","    "
"0","    sigma2 <- rinvgamma(1, shape=a_til, rate=b_til)"
"0","    sigma  <- sqrt(sigma2)"
"0"," "
"0","    A <-  XTX[j,j]/sigma2"
"0","    B <-  vB[i]/sigma2"
"0","    B <- as.vector(B)"
"0","    C <- -lambda/sigma"
"0","    "
"0","    y <- y + dlasso(x,A,B,C)"
"0","    "
"0","  }"
"0","  y <- y/K"
"0"," "
"0","  "
"0","  return(list(x=x,y=y))"
"0","} "
"0",""
"0","vb_phc_grad <- function(x, a_til, b_til, vmu_til, mSigma_til, XTX, XTy, lambda, j )"
"0","{"
"0","  vs <- vmu_til[-j] - mSigma_til[-j,j]*vmu_til[j]/mSigma_til[j,j]"
"0","  vt <- mSigma_til[-j,j]/mSigma_til[j,j]"
"0","    "
"0","    "
"0","  c0 <- (a_til/b_til)*(XTy[j] - XTX[j,-j]%*%vs)"
"0","  c1 <- (a_til/b_til)*(XTX[j,j] + XTX[j,-j]%*%vt)"
"0","  c2 <- lambda*exp(lgamma(a_til + 1/2) - lgamma(a_til) - 0.5*log(b_til))"
"0","  "
"0","  c0 <- as.vector(c0)"
"0","  c1 <- as.vector(c1)"
"0","  c2 <- as.vector(c2)"
"0","  "
"0","  cat(""c0="",c0,""\n"")"
"0","  cat(""c1="",c1,""\n"")"
"0","  cat(""c2="",c2,""\n"")"
"0","  "
"0","  y <- dlasso(x,c1,c0,-c2)"
"0","  "
"0","  return(list(x=x,y=y))"
"0","}"
"0",""
"0",""
"0","vb_phc_grad2 <- function(x, E_sigma2inv, E_sigmainv, vmu_til, mSigma_til, XTX, XTy, lambda, j )"
"0","{"
"0","  vs <- vmu_til[-j] - mSigma_til[-j,j]*vmu_til[j]/mSigma_til[j,j]"
"0","  vt <- mSigma_til[-j,j]/mSigma_til[j,j]"
"0","    "
"0","    "
"0","  c0 <- E_sigma2inv*(XTy[j] - XTX[j,-j]%*%vs)"
"0","  c1 <- E_sigma2inv*(XTX[j,j] + XTX[j,-j]%*%vt)"
"0","  c2 <- lambda*E_sigmainv"
"0","  "
"0","  c0 <- as.vector(c0)"
"0","  c1 <- as.vector(c1)"
"0","  c2 <- as.vector(c2)"
"0","  "
"0","  y <- dlasso(x,c1,c0,-c2)"
"0","  "
"0","  return(list(x=x,y=y))"
"0","}"
