\documentclass[]{article}
\usepackage{geometry}
\usepackage{amsfonts}
\geometry{verbose,a4paper,tmargin=1in,bmargin=1.0in,lmargin=1in,rmargin=1in}
\usepackage{atkinson}
\usepackage{amsmath}

\title{Bivariate Lasso Distribution Derivation}
\author{Yuhao Li}

\begin{document}

\maketitle


\section{Setting}
If $x \sim \mbox{MultiLasso}(A,b,c)$ with then it has density given by
$$
p(x,a,b,c) = Z^{-1} exp(-\frac{1}{2}x^TAx +b^Tx -c ||x||_1)
$$

\noindent where $A \in S_d^+$: positive definite matrix with dimension d, $b \in R^2$, $c > 0$\\

\section{Finding Normalizing Constant}


$$
\begin{array}{rl}
	Z(a,b,c)
	& = \int_{-\infty}^\infty \int_{-\infty}^\infty \exp\left[ -\frac{1}{2}x^TAx + \textbf{b}^Tx - c\textbf{1}^T|x|_1 \right] d\textbf{x}
	\\ [2ex]
	& 
	= \int_0^\infty\int_0^\infty    \exp\left[ -\frac{1}{2}x^TAx + (\textbf{b}^T - c\textbf{1}^T)x \right] d\textbf{x}
	+ \int_0^\infty\int_{-\infty}^0 \exp\left[ -\frac{1}{2}x^TAx + (\textbf{b}^T - c[1,-1]^T)x \right] d\textbf{x}\\
	& \qquad
	+ \int_{-\infty}^0\int_0^\infty \exp\left[ -\frac{1}{2}x^TAx + (\textbf{b}^T - c[-1,1]^T)x \right] d\textbf{x}
	+ \int_{-\infty}^0\int_{-\infty}^0 \exp\left[ -\frac{1}{2}x^TAx + (\textbf{b}^T + c\textbf{1}^T)x \right]d\textbf{x}
	
	\\ [2ex]
	&
	= \int_0^\infty\int_0^\infty    \exp\left[ -\frac{1}{2}x^TAx + (\textbf{b}^T - c\textbf{1}^T)x \right] d\textbf{x}
	
	+ \int^\infty_0\int^{\infty}_0 \exp\left[ 
	-\frac{1}{2}x^TA\otimes \begin{bmatrix}
		1 & -1\\
		-1 & 1\\
	\end{bmatrix}x + (b_1-c,-b_2-c)^Tx \right] d\textbf{x}\\
	& \qquad
	+ \int_0^\infty\int_0^\infty   \exp\left[ 	
	 -\frac{1}{2}x^TA \otimes 	\begin{bmatrix}
	 	1 & -1\\
	 	-1 & 1\\
	 \end{bmatrix}x + (-b_1-c,b_2-c)^Tx \right] d\textbf{x}\\
 
 	& \qquad
	
	+ \int_0^\infty\int_0^\infty   \exp\left[ -\frac{1}{2}x^TAx + (\textbf{b}^T + c\textbf{1}^T)x \right]d\textbf{x}
	
	\\ [2ex]
	&
	= \int_0^\infty\int_0^\infty    \exp\left[ -\frac{1}{2}x^TAx + (\textbf{b}^T - c\textbf{1}^T)x \right] d\textbf{x}

	+ \int^\infty_0\int^{\infty}_0 \exp\left[ -\frac{1}{2}x^TA^*x + (b_1-c,-b_2-c)^Tx \right] d\textbf{x}\\
	& \qquad
	+ \int_0^\infty\int_0^\infty   \exp\left[ -\frac{1}{2}x^TA^*x + (-b_1-c,b_2-c)^Tx \right] d\textbf{x}
	
	+ \int_0^\infty\int_0^\infty   \exp\left[ -\frac{1}{2}x^TAx - (\textbf{b}^T + c\textbf{1}^T)x \right]d\textbf{x}
	
	\\ [2ex]
	
	&
	= \int_0^\infty\int_0^\infty    \exp\left[ -\frac{1}{2}(x^TAx -2 (\textbf{b}^T - c\textbf{1}^T)x) \right] d\textbf{x}
	
	+ \int^\infty_0\int^{\infty}_0 \exp\left[ -\frac{1}{2}(x^TA^*x -2 (b_1-c,-b_2-c)^Tx) \right] d\textbf{x}\\
	& \qquad
	+ \int_0^\infty\int_0^\infty   \exp\left[ -\frac{1}{2}(x^TA^*x -2 (-b_1-c,b_2-c)^Tx) \right] d\textbf{x}
	
	+ \int_0^\infty\int_0^\infty   \exp\left[ -\frac{1}{2}(x^TAx +2 (\textbf{b}^T + c\textbf{1}^T)x) \right]d\textbf{x}
	
	\\ [2ex]
	
	&
	= \int_0^\infty\int_0^\infty    \exp\left[ -\frac{1}{2}(x-\mu_1)^TA(x-\mu_1) + \frac{(A\mu_1)^TA^{-1}(A\mu_1)]}{2} \right] d\textbf{x}\\
	& \qquad	
	+ \int_0^\infty\int_0^\infty    \exp\left[ -\frac{1}{2}(x-\mu_2)^TA^*(x-\mu_2) + \frac{(A^*\mu_2)^TA^{*-1}(A^*\mu_2)]}{2} \right] d\textbf{x}\\
	& \qquad
	+ \int_0^\infty\int_0^\infty    \exp\left[ -\frac{1}{2}(x-\mu_3)^TA^*(x-\mu_3) + \frac{(A^*\mu_3)^TA^{-1}(A^*\mu_3)]}{2} \right] d\textbf{x}\\
	& \qquad	
	+ \int_0^\infty\int_0^\infty    \exp\left[ -\frac{1}{2}(x-\mu_4)^TA(x-\mu_4) + \frac{(A\mu_4)^TA^{-1}(A\mu_4)]}{2} \right] d\textbf{x}
	
	\\ [2ex]
	&
	= \int_0^\infty\int_0^\infty    \exp\left[ -\frac{1}{2}(x-\mu_1)^T\Sigma_1^{-1}(x-\mu_1) + \frac{(A\mu_1)^T\Sigma_1(A\mu_1)]}{2} \right] d\textbf{x}\\
	& \qquad	
	+ \int_0^\infty\int_0^\infty    \exp\left[ -\frac{1}{2}(x-\mu_2)^T\Sigma_2^{-1}(x-\mu_2) + \frac{(A^*\mu_2)^T\Sigma_2(A^*\mu_2)]}{2} \right] d\textbf{x}\\
	& \qquad
	+ \int_0^\infty\int_0^\infty    \exp\left[ -\frac{1}{2}(x-\mu_3)^T\Sigma_2^{-1}(x-\mu_3) + \frac{(A^*\mu_3)^T\Sigma_2(A^*\mu_3)]}{2} \right] d\textbf{x}\\
	& \qquad	
	+ \int_0^\infty\int_0^\infty    \exp\left[ -\frac{1}{2}(x-\mu_4)^T\Sigma_1^{-1}(x-\mu_4) + \frac{(A\mu_4)^T\Sigma_1(A\mu_4)]}{2} \right] d\textbf{x}	
		
	\\ [2ex]
	&	 
	=  2\pi|\Sigma_1|^{\frac{1}{2}}[\exp\left[ \frac{(A\mu_1)^T\Sigma_1(A\mu_1)]}{2} \right] \int_0^\infty\int_0^\infty \phi_2(x;\mu_1,\Sigma_1)d\textbf{x} 	+  \exp\left[ \frac{(A\mu_4)^T\Sigma_1(A\mu_4)]}{2} \right] \int_0^\infty\int_0^\infty \phi_2(x;\mu_4,\Sigma_1)d\textbf{x}])\\
	& \qquad	
	+ 2\pi|\Sigma_2|^{\frac{1}{2}}(\exp\left[ \frac{(A^*\mu_2)^T\Sigma_2(A^*\mu_2)]}{2} \right] \int_0^\infty\int_0^\infty \phi_2(x;\mu_2,\Sigma_2)d\textbf{x}
	+  \exp\left[ \frac{(A^*\mu_3)^T\Sigma_2(A^*\mu_3)]}{2} \right] \int_0^\infty\int_0^\infty \phi_2(x;\mu_3,\Sigma_2)d\textbf{x})\\
	

	
	&
	=|\Sigma_1| (\frac{\int_0^\infty\int_0^\infty \phi_2(x;\mu_1,\Sigma_1)d\textbf{x}}{\phi_2(A\mu_1,\Sigma_1^{-1})} + \frac{\int_0^\infty\int_0^\infty \phi_2(x;\mu_4,\Sigma_1)d\textbf{x}}{\phi_2(A\mu_4,\Sigma_1^{-1})}) + |\Sigma_2| (\frac{\int_0^\infty\int_0^\infty \phi_2(x;\mu_2,\Sigma_2)d\textbf{x}}{\phi_2(A^*\mu_2,\Sigma_2^{-1})} + \frac{\int_0^\infty\int_0^\infty \phi_2(x;\mu_3,\Sigma_2)d\textbf{x}}{\phi_2(A^*\mu_3,\Sigma_2^{-1})} +))
	
	
	
\end{array} 
$$

\noindent where $\mu_1 = A^{-1}(b-c\textbf{1})^T$, $\mu_2 = A^{*-1}(b_1-c,-b_2-c)^T, \mu_3 = A^{*-1}(-b_1-c,b_2-c)^T \mu_4 = A^{-1}(-b-c \textbf{1}^T)^T $ and $\Sigma_1 = A^{-1}$, $\Sigma_2 = A^{*-1}$ $A^* = A \otimes 	\begin{bmatrix}
	1 & -1\\
	-1 & 1\\
\end{bmatrix}$.

\newpage

\section{Find Expectation}
Follow similar step as before
$$
\begin{array}{rl}
	E[X] 
	& = Z^{-1} \int_{-\infty}^\infty \int_{-\infty}^\infty x \otimes \exp\left[ -\frac{1}{2}x^TAx + \textbf{b}^Tx - c\textbf{1}^T||x||_1 \right] d\textbf{x}\\ [2ex]

	& \qquad
	= Z^{-1} \int_0^\infty\int_0^\infty x \otimes   \exp\left[ -\frac{1}{2}x^TAx + (\textbf{b}^T - c\textbf{1}^T)x \right] d\textbf{x}\\
	
	& \qquad
	+ \int^\infty_0\int^{\infty}_0 [1,-1]^T \otimes x \otimes  \exp\left[ 
	-\frac{1}{2}x^TA^*\otimes \begin{bmatrix}
		1 & -1\\
		-1 & 1\\
	\end{bmatrix}x + (b_1-c,-b_2-c)^Tx \right] d\textbf{x}\\
	& \qquad
	+ \int_0^\infty\int_0^\infty  [-1,1]^T \otimes x \otimes    \exp\left[ 	
	-\frac{1}{2}x^TA^* \otimes 	\begin{bmatrix}
		1 & -1\\
		-1 & 1\\
	\end{bmatrix}x + (-b_1-c,b_2-c)^Tx \right] d\textbf{x}\\
	
	& \qquad
	
	- \int_0^\infty\int_0^\infty x \otimes  \exp\left[ -\frac{1}{2}x^TAx + (\textbf{b}^T + c\textbf{1}^T)x \right]d\textbf{x}\\

	& \qquad
	=  Z^{-1}[|\Sigma_1|(\frac{\int_0^\infty\int_0^\infty x\otimes\phi_2(x;\mu_1,\Sigma)d\textbf{x}}{\phi_2(A\mu_1,\Sigma_1^{-1}))}
	-  \frac{\int_0^\infty\int_0^\infty x\otimes\phi_2(x;\mu_4,\Sigma)d\textbf{x}}{\phi_2(A\mu_4,\Sigma_1^{-1}))})\\
	& \qquad
	+ |\Sigma_2|
	 ([1,-1]^T\frac{\int_0^\infty\int_0^\infty x\otimes\phi_2(x;\mu_2,\Sigma_2)d\textbf{x}}{\phi_2(A^*\mu_2,\Sigma_2^{-1}))}
	+ [-1,1]^T   \frac{\int_0^\infty\int_0^\infty x\otimes\phi_2(x;\mu_3,\Sigma_2)d\textbf{x}}{\phi_2(A^*\mu_3,\Sigma_2^{-1})})]
	\\
	& \qquad
	=  Z^{-1}[|\Sigma_1|(\frac{E[\textbf{A}]\int_0^\infty\int_0^\infty \phi_2(x;\mu_1,\Sigma_1)d\textbf{x}}{\phi_2(A\mu_1,\Sigma_1^{-1}))}
	-  \frac{E[D]\int_0^\infty\int_0^\infty \phi_2(x;\mu_4,\Sigma_1)d\textbf{x}}{\phi_2(A\mu_4,\Sigma_1^{-1}))})\\
	& \qquad
	+ 
	|\Sigma_2|(
	[1,-1]^T \frac{E[B]\int_0^\infty\int_0^\infty \phi_2(x;\mu_2,\Sigma_2)d\textbf{x}}{\phi_2(A^*\mu_2,\Sigma_2^{-1}))}
	+ [-1,1]^T   \frac{E[C]\int_0^\infty\int_0^\infty \phi_2(x;\mu_3,\Sigma_2)d\textbf{x}}{\phi_2(A^*\mu_3,\Sigma_2^{-1})})]
	\\
	&
	
	
\end{array}
$$
\noindent where $\mu_1 = A^{-1}(b-c\textbf{1})^T$, $\mu_2 = A^{*-1}(b_1-c,-b_2-c)^T, \mu_3 = A^{*-1}(-b_1-c,b_2-c)^T \mu_4 = A^{-1}(-b-c \textbf{1}^T)^T $ and $\Sigma_1 = A^{-1}$, $\Sigma_2 = A^{*-1}$ $A^* = A \otimes 	\begin{bmatrix}
	1 & -1\\
	-1 & 1\\
\end{bmatrix}$.
\noindent $\textbf{A}\sim MTN_+(\mu_1,\Sigma_1)$, $B\sim MTN_+(\mu_2,\Sigma_2)$, $C\sim MTN_+(\mu_3,\Sigma_2)$, $D\sim MTN_+(\mu_4,\Sigma_1)$ is denotes the multivariate positively truncated normal distribution.

\section{Find Covariance Matrix}
Follow similar steps as before
$$
Cov(X) = E[XX^T] - E[X]E[X]^T
$$
$$
\begin{array}{rl}
	E[XX^T] 
	& = \int_{-\infty}^\infty \int_{-\infty}^\infty xx^T \otimes \exp\left[ -\frac{1}{2}x^TAx + \textbf{b}^Tx - c\textbf{1}^T||x||_1 \right] d\textbf{x}\\ [2ex]
	& 
	= Z^{-1} 2\pi|\Sigma|^{\frac{1}{2}}[\exp\left[ \frac{(A\mu_1)^T\Sigma(A\mu_1)]}{2} \right] \int_0^\infty\int_0^\infty xx^T\otimes\phi_2(x;\mu_1,\Sigma_1)d\textbf{x}\\
	& \qquad	
	+ 	\begin{bmatrix}
		1 & -1\\
		-1 & 1\\
	\end{bmatrix} \otimes \exp\left[ \frac{(A^*\mu_2)^T\Sigma(A^*\mu_2)]}{2} \right] \int_0^\infty\int_0^\infty xx^T\otimes\phi_2(x;\mu_2,\Sigma_2)d\textbf{x}\\
	& \qquad
	+ 	\begin{bmatrix}
		1 & -1\\
		-1 & 1\\
	\end{bmatrix}  \otimes  \exp\left[ \frac{(A^*\mu_3)^T\Sigma(A^*\mu_3)]}{2} \right] \int_0^\infty\int_0^\infty xx^T\otimes\phi_2(x;\mu_3,\Sigma_2)d\textbf{x}\\
	& \qquad	
	-  \exp\left[ \frac{(A\mu_4)^T\Sigma(A\mu_4)]}{2} \right] \int_0^\infty\int_0^\infty xx^T\otimes\phi_2(x;\mu_4,\Sigma_1)d\textbf{x}]\\
	\\
	&
	=  Z^{-1}|\Sigma|[ \frac{\int_0^\infty\int_0^\infty xx^T\otimes\phi_2(x;\mu_1,\Sigma)d\textbf{x}}{\phi_2(A\mu_1,\Sigma))}
	
	+ 	\begin{bmatrix}
		1 & -1\\
		-1 & 1\\
	\end{bmatrix} \otimes  \frac{\int_0^\infty\int_0^\infty xx^T\otimes\phi_2(x;\mu_2,\Sigma)d\textbf{x}}{\phi_2(A\mu_2,\Sigma))}\\
	& \qquad
	+	\begin{bmatrix}
		1 & -1\\
		-1 & 1\\
	\end{bmatrix} \otimes   \frac{\int_0^\infty\int_0^\infty xx^T\otimes\phi_2(x;\mu_3,\Sigma)d\textbf{x}}{\phi_2(A\mu_3,\Sigma))}
	
	-  \frac{\int_0^\infty\int_0^\infty xx^T\otimes\phi_2(x;\mu_4,\Sigma)d\textbf{x}}{\phi_2(A\mu_4,\Sigma))}]\\
	\\
	&
	=  Z^{-1}[|\Sigma_1|(\frac{E[\textbf{A}\textbf{A}^T]\int_0^\infty\int_0^\infty \phi_2(x;\mu_1,\Sigma_1)d\textbf{x}}{\phi_2(A\mu_1,\Sigma_1^{-1}))}
	+  \frac{E[DD^T]\int_0^\infty\int_0^\infty \phi_2(x;\mu_4,\Sigma_1)d\textbf{x}}{\phi_2(A\mu_4,\Sigma_1^{-1}))})\\
	& \qquad
	+ 
	|\Sigma_2|(
	\begin{bmatrix}
	1 & -1\\
	-1 & 1\\
\end{bmatrix} \otimes \frac{E[BB^T]\int_0^\infty\int_0^\infty \phi_2(x;\mu_2,\Sigma_2)d\textbf{x}}{\phi_2(A^*\mu_2,\Sigma_2^{-1}))}

	+\begin{bmatrix}
		1 & -1\\
		-1 & 1\\
	\end{bmatrix} \otimes   \frac{E[CC^T]\int_0^\infty\int_0^\infty \phi_2(x;\mu_3,\Sigma_2)d\textbf{x}}{\phi_2(A^*\mu_3,\Sigma_2^{-1})})]
	\\
	
	
\end{array}
$$
\noindent where $\mu_1 = A^{-1}(b-c\textbf{1})^T$, $\mu_2 = A^{*-1}(b_1-c,-b_2-c)^T, \mu_3 = A^{*-1}(-b_1-c,b_2-c)^T \mu_4 = A^{-1}(-b-c \textbf{1}^T)^T $ and $\Sigma_1 = A^{-1}$, $\Sigma_2 = A^{*-1}$ $A^* = A \otimes 	\begin{bmatrix}
	1 & -1\\
	-1 & 1\\
\end{bmatrix}$.
\noindent $\textbf{A}\sim MTN_+(\mu_1,\Sigma_1)$, $B\sim MTN_+(\mu_2,\Sigma_2)$, $C\sim MTN_+(\mu_3,\Sigma_2)$, $D\sim MTN_+(\mu_4,\Sigma_1)$ is denotes the multivariate positively truncated normal distribution.

$$
E[AA^T] = Cov(A) - E[A]E[A]^T 
$$


\end{document}
